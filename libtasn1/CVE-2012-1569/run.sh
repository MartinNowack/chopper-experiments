#!/bin/bash

MAX_TIME=86400
MAX_MEMORY=3000

function run_klee {
search=$1
size=$2
out_dir=$3
time klee \
    -output-dir=$3 \
    -max-time=${MAX_TIME} \
    -max-memory=${MAX_MEMORY} \
    -exit-on-error-type=Ptr \
    -libc=uclibc \
    -search=${search} \
    test.bc ${size}
}

function run_cse {
search=$1
size=$2
out_dir=$3
time klee \
    -output-dir=$3 \
    -max-time=${MAX_TIME} \
    -max-memory=${MAX_MEMORY} \
    -exit-on-error-type=Ptr \
    -libc=uclibc \
    -search=${search} \
    -split-search \
    -skip-functions=_asn1_set_value:1043,asn1_der_decoding_bb \
    -inline=memcpy,strlen \
    test.bc ${size}
}

TEST_SIZE=32

# KLEE
run_klee random-state ${TEST_SIZE} klee-random-state
run_klee nurs:covnew ${TEST_SIZE} klee-covnew
#run_klee dfs ${TEST_SIZE} klee-dfs

# CSE
run_cse random-state ${TEST_SIZE} cse-random-state
run_cse nurs:covnew ${TEST_SIZE} cse-covnew
#run_cse dfs ${TEST_SIZE} cse-dfs
